# 🔄 종목 갱신 (Refresh) 기능 가이드

## 📋 개요

`refresh` 명령어로 거래 대상 종목 목록을 수동으로 갱신할 수 있습니다.

**핵심:** 기존 포지션은 유지하면서 새로운 매수만 갱신된 목록에서 진행!

---

## 🎯 사용 시기

### 언제 사용하나요?

#### 1. 시장 상황 변화
```
예: 비트코인 급등 → 알트코인으로 자금 이동
   → refresh로 상승세 코인 재선정
```

#### 2. 수동 개입 필요
```
예: 특정 코인을 거래하고 싶지 않음
   → refresh로 다른 코인 선정
```

#### 3. 정기 점검
```
예: 하루에 한 번 수동 갱신
   → 최신 트렌드 반영
```

---

## 💻 사용 방법

### 콘솔에서

```bash
💻 명령어 입력 > refresh

================================================================================
🔄 종목 목록 갱신
================================================================================

📋 현재 목록 (3개)
  📍 BTC
     ETH
  📍 XRP

📊 변경 사항
  유지: 2개
  추가: 1개
  제외: 1개

➕ 추가된 종목
   SOL

➖ 제외된 종목
   ETH 📍 포지션 유지

✅ 종목 목록 갱신 완료

💡 안내:
   - 제외된 종목의 포지션은 유지됩니다
   - 매도 신호 발생 시 정상적으로 청산됩니다
   - 새로운 매수는 갱신된 목록에서만 진행됩니다
================================================================================
```

---

### 텔레그램에서

```
📱 당신: /refresh

🤖 봇:
🔄 종목 갱신 완료

📊 변경사항
유지: 2개
추가: 1개
제외: 1개

➕ 추가: SOL
➖ 제외: ETH 📍

💡 제외된 종목의 포지션은 유지됩니다
```

---

## 🔍 동작 원리

### Before (갱신 전)
```
거래 대상 목록:
- BTC (포지션 있음)
- ETH (포지션 없음)
- XRP (포지션 있음)

다음 매수 대상:
→ BTC, ETH, XRP 중에서 선택
```

### After (갱신 후)
```
거래 대상 목록:
- BTC (유지)
- SOL (추가)
- XRP (유지)

제외된 코인:
- ETH (포지션 유지, 새 매수 안 함)

다음 매수 대상:
→ BTC, SOL, XRP 중에서만 선택
```

---

## 📊 실전 예시

### 시나리오 1: ETH 포지션이 있는 경우

#### Before
```
목록: BTC, ETH, XRP
포지션: ETH (+2.5%)
```

#### Refresh 실행
```
💻 명령어 입력 > refresh

새 목록: BTC, SOL, XRP
제외: ETH 📍 포지션 유지
```

#### After
```
목록: BTC, SOL, XRP
포지션: ETH (+2.5%) ← 여전히 보유!

ETH는:
✅ 계속 모니터링
✅ 매도 신호 발생 시 청산
❌ 새로운 매수는 안 함
```

---

### 시나리오 2: ETH 포지션이 없는 경우

#### Before
```
목록: BTC, ETH, XRP
포지션: 없음
```

#### Refresh 실행
```
💻 명령어 입력 > refresh

새 목록: BTC, SOL, XRP
제외: ETH
```

#### After
```
목록: BTC, SOL, XRP
포지션: 없음

ETH는:
❌ 완전히 제외됨
```

---

### 시나리오 3: 모두 유지되는 경우

#### Refresh 실행
```
💻 명령어 입력 > refresh

📊 변경 사항
  유지: 3개
  추가: 0개
  제외: 0개

✅ 종목 목록 갱신 완료
(변경사항 없음)
```

---

## 🎯 활용 전략

### 전략 1: 일일 갱신
```
매일 아침:
1. status로 현재 상태 확인
2. refresh로 종목 갱신
3. 하루 시작!

효과:
✅ 최신 트렌드 반영
✅ 상승세 코인 포착
```

### 전략 2: 시장 변화 대응
```
뉴스 확인 후:
1. 비트코인 급등 뉴스
2. refresh로 알트코인 재선정
3. 새로운 기회 포착

효과:
✅ 빠른 대응
✅ 기회 극대화
```

### 전략 3: 수동 필터링
```
특정 코인 제외 원할 때:
1. refresh 실행
2. 운 좋게 제외되기를 기다림
   (또는 excluded_coins 설정)

효과:
✅ 선택적 거래
```

---

## ⚙️ 자동 갱신 vs 수동 갱신

### 자동 갱신 (기본)
```
설정: refresh_interval_hours: 1

장점:
✅ 자동 실행
✅ 신경 쓸 필요 없음

단점:
❌ 타이밍 제어 불가
```

### 수동 갱신 (refresh 명령어)
```
명령어: refresh

장점:
✅ 원하는 시점에 실행
✅ 타이밍 제어 가능
✅ 즉시 반영

단점:
❌ 수동 입력 필요
```

### 권장 조합
```
자동 갱신: 비활성화
수동 갱신: 필요할 때만

또는

자동 갱신: 6시간
수동 갱신: 급할 때 추가
```

---

## 🔒 안전성

### 포지션 보호
```
✅ 기존 포지션 절대 삭제 안 됨
✅ 매도 신호까지 정상 추적
✅ 익절/손절 그대로 작동
```

### 매수 제한
```
제외된 코인:
❌ 새로운 매수 불가
✅ 기존 포지션 유지
```

---

## 📋 주의사항

### ⚠️ 주의 1: 포지션 있는 코인 제외 시
```
ETH 포지션 +2.5% 보유 중
→ refresh로 ETH 제외됨
→ ETH 포지션은 계속 유지
→ 매도 신호까지 추적됨

걱정 마세요! 자동으로 관리됩니다 ✅
```

### ⚠️ 주의 2: 실행 중에만 가능
```
❌ stop 상태에서 refresh
   → "실행 중이 아닙니다" 메시지

✅ start 후 refresh
   → 정상 작동
```

### ⚠️ 주의 3: 갱신 실패 가능
```
네트워크 문제 등으로 실패 시:
→ 기존 목록 유지
→ 다시 시도 가능
```

---

## 🔍 로그 확인

### 성공 시
```bash
tail -f logs/trading_bot.log

[INFO] 수동 종목 갱신 시작
[INFO] 종목 갱신 완료: 유지 2, 추가 1, 제외 1
```

### 실패 시
```bash
[WARNING] 종목 갱신 실패
```

---

## 💡 FAQ

### Q1. 제외된 코인의 포지션은 어떻게 되나요?
**A:** 그대로 유지되고 정상적으로 추적됩니다. 매도 신호 발생 시 자동으로 청산됩니다.

### Q2. 언제 refresh를 사용해야 하나요?
**A:** 
- 시장 상황이 크게 변했을 때
- 특정 코인을 거래하고 싶지 않을 때
- 새로운 상승세 코인을 포착하고 싶을 때

### Q3. 자동 갱신과 차이가 뭔가요?
**A:** 자동은 설정된 시간마다, 수동은 원하는 시점에 즉시 실행됩니다.

### Q4. refresh 후 바로 매수되나요?
**A:** 아니요. 갱신된 목록에서 매수 신호가 발생할 때만 매수됩니다.

### Q5. 하루에 몇 번까지 할 수 있나요?
**A:** 제한 없습니다. 하지만 너무 자주 하면 불필요할 수 있습니다.

---

## 🎯 권장 사용법

### 초보자
```
1. 자동 갱신만 사용 (refresh_interval_hours: 2)
2. refresh 명령어는 사용 안 함
```

### 중급자
```
1. 자동 갱신: 6시간
2. 필요할 때 수동 refresh
3. 하루 1-2회 정도
```

### 고급자
```
1. 자동 갱신: 비활성화
2. 시장 관찰 후 수동 refresh
3. 뉴스/차트 보고 타이밍 결정
```

---

## 🚀 실전 예시

### 아침 루틴
```
09:00 - 프로그램 시작
        status 확인
        refresh 실행
        
09:30 - 새 목록에서 매수 시작
```

### 점심 체크
```
12:00 - status 확인
        시장 변화 크면 refresh
```

### 저녁 정리
```
21:00 - daily 확인
        필요시 refresh
        pause (선택)
```

---

**종목 갱신으로 항상 최적의 코인을 거래하세요!** 🔄

**포지션은 안전하게 유지되니 걱정하지 마세요!** ✅
